<%- include('./partials/header.ejs') %>
Number of entries: <b><%= search.Count %></b><br />

<% var the_ids = search.IdList[0].Id %>
Search size: <b><%= the_ids.length %></b><br />
Fetch size: <b><%= fetch.length %></b> (should be the same as search
size)

<br /><br />

<table class="table table-striped table-bordered table-sm table-hover"
cellspacing="0" width="100%" id="geoDatasets">
  <thead>
    <th class="th-sm" style="cursor:pointer;" scope="col">ID</th>
    <th class="th-sm" style="cursor:pointer;" scope="col">accession</th>
    <th class="th-sm w-25" style="cursor:pointer;" scope="col">title</th>
    <th class="th-sm" style="cursor:pointer;" scope="col">sequencer</th>
    <th class="th-sm" style="cursor:pointer;" scope="col">species</th>
  </thead>
  <tbody>
    <% for (var i = 0; i < fetch.length; ++i) { %>
      <tr>
        <!-- ID  -->
        <th scope="row"> <a href="/geo/<%= the_ids[i] %>"><%=the_ids[i] %></th>
        <!-- accession -->
        <td>
        <% if (typeof fetch[i].EXPERIMENT !== "undefined") { %>
          <% var the_accession = fetch[i].EXPERIMENT[0].$.accession %>
          <a href="https://www.ncbi.nlm.nih.gov/sra/?term=<%= the_accession %>"  target="_blank">
            <%= the_accession %>
          </a>
        <% } else { %>
          NO ACCESSION FOUND!
        <% } %>
        </td>
        <!--  title -->
        <td>
        <% if (typeof fetch[i].Pool !== "undefined" &&
               typeof fetch[i].Pool[0].Member !== "undefined") { %>
          <%= fetch[i].Pool[0].Member[0].$.sample_title %>
        <% } else { %>
          NO TITLE FOUND!
        <% } %>
        </td>
        <!--  sequencer -->
        <td>
        <% if (typeof fetch[i].EXPERIMENT !== "undefined" &&
               typeof fetch[i].EXPERIMENT[0].PLATFORM !==  "undefined" &&
               typeof fetch[i].EXPERIMENT[0].PLATFORM[0].ILLUMINA !== "undefined") { %>
          <%= fetch[i].EXPERIMENT[0].PLATFORM[0].ILLUMINA[0].INSTRUMENT_MODEL %>
        <% } else { %>
          NO INSTRUMENT FOUND!
        <% } %>
        </td>
        <!--  species -->
        <td>
        <% if (typeof fetch[i].Pool !== "undefined" &&
               typeof fetch[i].Pool[0].Member !== "undefined") { %>
          <% var the_organism = fetch[i].Pool[0].Member[0].$.organism %>
          <a href="https://duckduckgo.com/?q=<%= the_organism %>" target="_blank"><%= the_organism %></a>
        <% } else { %>
          NO SPECIES FOUND!
        <% } %>
        </td>
      </tr>
    <% } %>

  </tbody>
</table>
<script type="text/javascript">
$('th').click(function() {
  var table = $(this).parents('table').eq(0)
  var rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).index()))
  this.asc = !this.asc
  if (!this.asc) {
    rows = rows.reverse()
  }
  for (var i = 0; i < rows.length; i++) {
    table.append(rows[i])
  }
})

function comparer(index) {
  return function(a, b) {
    var valA = getCellValue(a, index);
    var valB = getCellValue(b, index)
    return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.toString().localeCompare(valB)
  }
}
function getCellValue(row, index) {
  return $(row).children('td').eq(index).text()
}

</script>
<%- include('./partials/footer.ejs') %>

